# EVE Static Data Export (SDE) Update Guide

This guide explains how to update the EVE Online Static Data Export (SDE) for EVEMon.

## Overview

EVEMon uses static data from CCP's SDE to provide information about skills, items, blueprints, geography, and more. The SDE is updated by CCP periodically, and EVEMon needs to be updated to reflect these changes.

## Prerequisites

- .NET 8 SDK installed
- EVE Online SDE YAML files (downloaded from CCP)

## Step 1: Download the Latest SDE

1. Go to the EVE Developers resources page or CCP's official SDE download location
2. Download the latest SDE in YAML format (typically named something like `sde-YYYYMMDD-TRANQUILITY.zip`)
3. Extract the YAML files to: `tools/SDEFiles/yaml_extracted/`

The extracted folder should contain files like:
- `types.yaml`
- `categories.yaml`
- `groups.yaml`
- `blueprints.yaml`
- `dogmaAttributes.yaml`
- `npcStations.yaml`
- `npcCorporations.yaml`
- etc.

## Step 2: Convert YAML to SQLite

The `YamlToSqlite` tool converts the YAML files directly to SQLite format.

```bash
cd tools/YamlToSqlite
dotnet run -- "D:\evemon-main\tools\SDEFiles\yaml_extracted" "D:\evemon-main\tools\sqlite-latest.sqlite"
```

Or on Linux/macOS:
```bash
cd tools/YamlToSqlite
dotnet run -- "../SDEFiles/yaml_extracted" "../sqlite-latest.sqlite"
```

Or simply run without arguments (uses default paths):
```bash
cd tools/YamlToSqlite
dotnet run
```

This will:
- Read all YAML files
- Create a SQLite database with all necessary tables
- Import all data

The process typically takes 30-40 seconds.

## Step 3: Generate Datafiles

The `XmlGenerator` tool reads the SQLite database and generates the compressed XML datafiles used by EVEMon.

1. First, ensure the connection string in `tools/XmlGenerator/App.config` points to the correct database:
   ```xml
   <connectionStrings>
     <add name="EveStaticData" connectionString="Data Source=D:\evemon-main\tools\sqlite-latest.sqlite" />
   </connectionStrings>
   ```

2. Run the generator:
   ```bash
   cd tools/XmlGenerator
   dotnet run
   ```

This will generate the following datafiles in `src/EVEMon.Common/Resources/`:
- `eve-properties-en-US.xml.gzip`
- `eve-skills-en-US.xml.gzip`
- `eve-geography-en-US.xml.gzip`
- `eve-blueprints-en-US.xml.gzip`
- `eve-items-en-US.xml.gzip`
- `eve-reprocessing-en-US.xml.gzip`

The files are also copied to:
- The build output directory (`bin/Debug/net8.0-windows/Resources/`)
- User's AppData folder (`%APPDATA%/EVEMon/`)

## Step 4: Verify the Update

1. Build and run EVEMon
2. Check that new items, skills, or ships appear correctly
3. Verify existing data wasn't corrupted

## Troubleshooting

### Schema Mismatches

If XmlGenerator fails with errors like "no such column", the YAML schema may have changed. You'll need to update:

1. `YamlToSqlite/Program.cs` - Add new columns to the CREATE TABLE statements and data classes
2. `XmlGenerator/Models/*.cs` - Update the EF Core model classes if needed

### Missing Data

If certain data is missing:

1. Check that all required YAML files are present
2. Verify the YAML file structure matches the expected format
3. Check the YamlToSqlite data classes for proper property mappings

### YAML Format Changes

CCP occasionally changes the YAML format. Common issues:

- **Localized strings**: Many fields use dictionaries for localization (e.g., `{"en": "Name", "de": "Name", ...}`)
- **Nested structures**: Some data uses wrapper objects with lists
- **Property name changes**: Use `[YamlMember(Alias = "yamlName")]` attribute to map different names

## Notes

### Certificates and Masteries

The `eve-certificates-en-US.xml.gzip` and `eve-masteries-en-US.xml.gzip` files are NOT generated by XmlGenerator. These require separate data sources and handling.

### YamlToSqlite vs EVESDEToSQL

This project originally used `EVESDEToSQL` which required SQL Server Express. The new `YamlToSqlite` tool was created to:
- Remove the SQL Server dependency
- Work directly with YAML files
- Simplify the update process
- Support cross-platform development

### Database Location

The SQLite database (`sqlite-latest.sqlite`) is stored in the `tools/` directory. This file is not committed to version control and must be regenerated when updating the SDE.
